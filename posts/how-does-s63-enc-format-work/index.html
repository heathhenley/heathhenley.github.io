<!doctype html><html lang=en-us prefix="og: http://ogp.me/ns#"><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><title>How Does S-63 Electronic Navigational Chart (ENC) Format Work?</title><meta property="og:title" content="How Does S-63 Electronic Navigational Chart (ENC) Format Work?"><meta name=twitter:title content="How Does S-63 Electronic Navigational Chart (ENC) Format Work?"><meta name=description content="A high level overview of the IHO S-63 standard, and how to implement the main parts in Python. This post talks about the S-63 standard, a data protection scheme for official Electronic Navigational Charts (ENCs). It's a process for encrypting and signing S-57 data, and it's used to make sure that the data is official, and that it hasn't been tampered with. It also makes it possible for data providers to license sections of the charts (cells) and be sure that they are not being shared illegally / pirated. All of the examples are implemented in python and available in a Gist. S-57 will eventually be replaced by the S-100 standard - but it will probably be around for a while."><meta property="og:description" content="A high level overview of the IHO S-63 standard, and how to implement the main parts in Python. This post talks about the S-63 standard, a data protection scheme for official Electronic Navigational Charts (ENCs). It's a process for encrypting and signing S-57 data, and it's used to make sure that the data is official, and that it hasn't been tampered with. It also makes it possible for data providers to license sections of the charts (cells) and be sure that they are not being shared illegally / pirated. All of the examples are implemented in python and available in a Gist. S-57 will eventually be replaced by the S-100 standard - but it will probably be around for a while."><meta name=twitter:description content="A high level overview of the IHO S-63 standard, and how to implement the main parts in Python. This post talks about the S-63 standard, a data protection scheme for official Electronic Navigational â€¦"><meta name=author content="Heath Henley"><meta property="og:site_name" content="Blogging by Heathâ„¢"><meta property="og:url" content="https://heathhenley.dev/posts/how-does-s63-enc-format-work/"><meta property="og:image" content="https://heathhenley.dev/s63/thumbnail.png"><meta name=twitter:image content="https://heathhenley.dev/s63/thumbnail.png"><meta name=twitter:card content="summary"><meta name=twitter:site content="@Heath_Henley"><meta name=twitter:creator content="@Heath_Henley"><meta property="og:type" content="article"><meta name=generator content="Hugo 0.118.2"><script async src="https://www.googletagmanager.com/gtag/js?id=G-LHHPTPJRGL"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-LHHPTPJRGL")</script><link rel=stylesheet href=https://heathhenley.dev/css/style.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/sakura.css/css/sakura.css type=text/css><link rel=stylesheet href=https://heathhenley.dev/css/custom.css><link rel=icon type=image/x-icon href=https://heathhenley.dev/favicon.png><script type=text/javascript src=https://heathhenley.dev/js/bundle.js></script></head><body><a href=#main class="skip-link p-screen-reader-text">Skip to content</a><svg xmlns="http://www.w3.org/2000/svg" style="display:none" aria-hidden="true"><symbol id="icon-500px" viewBox="0 0 16 16"><g><path d="M3.953 10.512a5.24 5.24.0 006.996 3.141c.625-.262 1.184-.641 1.666-1.122s.859-1.041 1.122-1.666c.272-.647.412-1.331.412-2.037s-.137-1.394-.412-2.037c-.262-.625-.641-1.184-1.122-1.666s-1.041-.859-1.666-1.122A5.226 5.226.0 008.912 3.59c-.716.0-1.431.144-2.066.413-.509.216-1.372.769-1.875 1.291l-.003.003V.984h7.241c.262-.003.262-.372.262-.491.0-.122.0-.487-.266-.491H4.377a.343.343.0 00-.344.341v6.066c0 .197.244.338.472.384.444.094.544-.047.653-.197l.016-.019c.166-.247.681-.766.688-.772a4.262 4.262.0 013.037-1.25c1.147.0 2.222.444 3.028 1.25a4.245 4.245.0 011.256 3.019 4.236 4.236.0 01-1.25 3.019 4.336 4.336.0 01-3.047 1.25 4.136 4.136.0 01-2.159-.597l.003-3.688c0-.491.213-1.028.572-1.431a2.09 2.09.0 011.588-.716c.594.0 1.15.225 1.566.634.409.406.637.95.637 1.528A2.179 2.179.0 018.887 11.02c-.238.0-.672-.106-.691-.109-.25-.075-.356.272-.391.387-.134.441.069.528.109.541.397.125.659.147 1.003.147a3.173 3.173.0 003.169-3.169c0-1.734-1.422-3.144-3.166-3.144-.856.0-1.659.328-2.263.919-.575.566-.903 1.319-.903 2.069v.019c-.003.094-.003 2.306-.006 3.031l-.003-.003c-.328-.363-.653-.919-.869-1.488-.084-.222-.275-.184-.534-.103-.125.034-.469.141-.391.394zm3.722-.865c0 .106.097.2.156.253l.019.019c.1.097.194.147.281.147a.181.181.0 00.131-.05c.044-.041.537-.544.588-.591l.553.55c.05.056.106.088.172.088.088.0.184-.053.284-.156.238-.244.119-.375.063-.438l-.559-.559.584-.588c.128-.137.016-.284-.097-.397-.162-.162-.322-.206-.422-.112l-.581.581-.588-.588a.16.16.0 00-.113-.047c-.078.0-.172.053-.275.156-.181.181-.219.306-.125.406l.588.584-.584.584c-.053.05-.078.103-.075.156zm1.278-7.931c-.938.0-1.938.191-2.669.506a.207.207.0 00-.134.181.753.753.0 00.069.337c.047.116.166.425.4.334a6.689 6.689.0 012.334-.444 6.35 6.35.0 012.469.497c.622.263 1.206.644 1.844 1.194a.22.22.0 00.147.059c.125.0.244-.122.347-.237.169-.191.287-.35.119-.509a6.858 6.858.0 00-2.1-1.356 7.326 7.326.0 00-2.825-.563zM14.006 13.3c-.113-.113-.209-.178-.294-.203s-.162-.006-.222.053l-.056.056a6.32 6.32.0 01-6.938 1.356 6.336 6.336.0 01-2.013-1.356 6.046 6.046.0 01-1.356-2.012c-.288-.713-.381-1.247-.413-1.422-.003-.016-.006-.028-.006-.037-.041-.206-.231-.222-.503-.178-.112.019-.459.072-.428.319v.006a7.261 7.261.0 002.04 3.994 7.266 7.266.0 0010.288.0l.059-.059c.069-.084.134-.225-.159-.516z"/></g></symbol><symbol id="icon-codepen" viewBox="0 0 16 16"><g><path d="M14.777 5.751l-7-4.667a.5.5.0 00-.555.0l-7 4.667a.501.501.0 00-.223.416v4.667c0 .167.084.323.223.416l7 4.667a.5.5.0 00.554.0l7-4.667a.501.501.0 00.223-.416V6.167a.501.501.0 00-.223-.416zM7.5 10.232 4.901 8.5 7.5 6.768 10.099 8.5 7.5 10.232zM8 5.899V2.434l5.599 3.732L11 7.898l-3-2zm-1 0-3 2-2.599-1.732L7 2.435V5.9zM3.099 8.5 1 9.899V7.101L3.099 8.5zM4 9.101l3 2v3.465l-5.599-3.732L4 9.102zm4 2 3-2 2.599 1.732L8 14.565V11.1zM11.901 8.5 14 7.101v2.798L11.901 8.5z"/></g></symbol><symbol id="icon-dribbble" viewBox="0 0 16 16"><g><path d="M8 16c-4.412.0-8-3.588-8-8s3.587-8 8-8c4.412.0 8 3.587 8 8s-3.588 8-8 8zm6.747-6.906c-.234-.075-2.116-.634-4.256-.291a29.7 29.7.0 011.328 4.872 6.845 6.845.0 002.928-4.581zM10.669 14.3c-.103-.6-.497-2.688-1.456-5.181-.016.006-.031.009-.044.016-3.856 1.344-5.241 4.016-5.362 4.266a6.807 6.807.0 006.863.9zm-7.747-1.722c.156-.266 2.031-3.369 5.553-4.509a7.04 7.04.0 01.269-.081 24.04 24.04.0 00-.553-1.159c-3.409 1.022-6.722.978-7.022.975-.003.069-.003.138-.003.209.0 1.753.666 3.356 1.756 4.566zM1.313 6.609c.306.003 3.122.016 6.319-.831A43.092 43.092.0 005.098 1.825 6.854 6.854.0 001.314 6.609zM6.4 1.366a36.612 36.612.0 012.55 4c2.431-.909 3.459-2.294 3.581-2.469A6.799 6.799.0 006.4 1.366zm6.891 2.325c-.144.194-1.291 1.663-3.816 2.694.159.325.313.656.453.991.05.119.1.234.147.353 2.275-.284 4.534.172 4.759.219A6.816 6.816.0 0013.29 3.692z"/></g></symbol><symbol id="icon-facebook" viewBox="0 0 16 16"><g><path d="M9.5 3H12V0H9.5C7.57.0 6 1.57 6 3.5V5H4v3h2v8h3V8h2.5l.5-3H9V3.5c0-.271.229-.5.5-.5z"/></g></symbol><symbol id="icon-feed" viewBox="0 0 16 16"><g><path d="M2.13 11.733c-1.175.0-2.13.958-2.13 2.126.0 1.174.955 2.122 2.13 2.122a2.126 2.126.0 002.133-2.122A2.133 2.133.0 002.13 11.733zM.002 5.436v3.067c1.997.0 3.874.781 5.288 2.196a7.45 7.45.0 012.192 5.302h3.08c0-5.825-4.739-10.564-10.56-10.564zM.006.0v3.068C7.128 3.068 12.924 8.87 12.924 16H16C16 7.18 8.824.0.006.0z"/></g></symbol><symbol id="icon-flickr" viewBox="0 0 16 16"><g><path d="M0 8.5a3.5 3.5.0 117 0 3.5 3.5.0 01-7 0zm9 0a3.5 3.5.0 117 0 3.5 3.5.0 01-7 0z"/></g></symbol><symbol id="icon-github" viewBox="0 0 16 16"><g><path d="M8 .198A8 8 0 005.471 15.789c.4.074.547-.174.547-.385.0-.191-.008-.821-.011-1.489-2.226.484-2.695-.944-2.695-.944-.364-.925-.888-1.171-.888-1.171-.726-.497.055-.486.055-.486.803.056 1.226.824 1.226.824.714 1.223 1.872.869 2.328.665.072-.517.279-.87.508-1.07-1.777-.202-3.645-.888-3.645-3.954.0-.873.313-1.587.824-2.147-.083-.202-.357-1.015.077-2.117.0.0.672-.215 2.201.82A7.672 7.672.0 018 4.066c.68.003 1.365.092 2.004.269 1.527-1.035 2.198-.82 2.198-.82.435 1.102.162 1.916.079 2.117.513.56.823 1.274.823 2.147.0 3.073-1.872 3.749-3.653 3.947.287.248.543.735.543 1.481.0 1.07-.009 1.932-.009 2.195.0.213.144.462.55.384A8 8 0 008.001.196z"/></g></symbol><symbol id="icon-gitlab" viewBox="0 0 28 28"><g><path d="M1.625 11.031 14 26.89.437 17.046a1.092 1.092.0 01-.391-1.203l1.578-4.813zm7.219.0h10.313L14.001 26.89zM5.75 1.469l3.094 9.562H1.625l3.094-9.562a.548.548.0 011.031.0zm20.625 9.562 1.578 4.813a1.09 1.09.0 01-.391 1.203l-13.563 9.844 12.375-15.859zm0 0h-7.219l3.094-9.562a.548.548.0 011.031.0z"/></g></symbol><symbol id="icon-google-plus" viewBox="0 0 16 16"><g><path d="M5.091 7.147v1.747h2.888c-.116.75-.872 2.197-2.888 2.197-1.737.0-3.156-1.441-3.156-3.216s1.419-3.216 3.156-3.216c.991.0 1.65.422 2.028.784L8.5 4.112c-.888-.828-2.037-1.331-3.409-1.331C2.275 2.784.0 5.059.0 7.875s2.275 5.091 5.091 5.091c2.937.0 4.888-2.066 4.888-4.975.0-.334-.037-.591-.081-.844H5.092zM16 7h-1.5V5.5H13V7h-1.5v1.5H13V10h1.5V8.5H16z"/></g></symbol><symbol id="icon-instagram" viewBox="0 0 22 22"><g><path d="M15.445.0H6.554A6.559 6.559.0 000 6.554v8.891A6.559 6.559.0 006.554 22h8.891a6.56 6.56.0 006.554-6.555V6.554A6.557 6.557.0 0015.445.0zm4.342 15.445a4.343 4.343.0 01-4.342 4.342H6.554a4.341 4.341.0 01-4.341-4.342V6.554a4.34 4.34.0 014.341-4.341h8.891a4.342 4.342.0 014.341 4.341l.001 8.891z"/><path d="M11 5.312A5.693 5.693.0 005.312 11 5.694 5.694.0 0011 16.688 5.694 5.694.0 0016.688 11 5.693 5.693.0 0011 5.312zm0 9.163a3.475 3.475.0 11-.001-6.95 3.475 3.475.0 01.001 6.95zm5.7-10.484a1.363 1.363.0 11-1.364 1.364c0-.752.51-1.364 1.364-1.364z"/></g></symbol><symbol id="icon-linkedin" viewBox="0 0 16 16"><g><path d="M6 6h2.767v1.418h.04C9.192 6.727 10.134 6 11.539 6 14.46 6 15 7.818 15 10.183V15h-2.885v-4.27c0-1.018-.021-2.329-1.5-2.329-1.502.0-1.732 1.109-1.732 2.255V15H6V6zM1 6h3v9H1V6zM4 3.5A1.5 1.5.0 11.999 3.499 1.5 1.5.0 014 3.5z"/></g></symbol><symbol id="icon-mail" viewBox="0 0 22 18"><g><path fill="#000" d="M0 17.225V.776h22v16.447H0v.002zm3.011-1.815h15.978l-5.111-5.115L11 13.179l-2.877-2.883-5.112 5.114zm-1.216-1.275 5.077-5.09L1.795 3.98v10.155zm13.332-5.09 5.079 5.09V3.979l-5.079 5.066zm-4.126 1.588 8.022-8.027-16.045-.001 8.023 8.028z"/></g></symbol><symbol id="icon-medium" viewBox="0 0 24 24"><g><path d="M22.085 4.733 24 2.901V2.5h-6.634l-4.728 11.768L7.259 2.5H.303v.401L2.54 5.594c.218.199.332.49.303.783V16.96c.069.381-.055.773-.323 1.05L0 21.064v.396h7.145v-.401l-2.52-3.049a1.244 1.244.0 01-.347-1.05V7.806l6.272 13.659h.729l5.393-13.659v10.881c0 .287.0.346-.188.534l-1.94 1.877v.402h9.412v-.401l-1.87-1.831a.556.556.0 01-.214-.534V5.267a.554.554.0 01.213-.534z"/></g></symbol><symbol id="icon-npm" viewBox="0 0 16 16"><g><path d="M0 0v16h16V0H0zm13 13h-2V5H8v8H3V3h10v10z"/></g></symbol><symbol id="icon-pinterest" viewBox="0 0 16 16"><g><path d="M8 1.069A6.93 6.93.0 005.475 14.453c-.059-.547-.116-1.391.025-1.988.125-.541.813-3.444.813-3.444s-.206-.416-.206-1.028c0-.963.559-1.684 1.253-1.684.591.0.878.444.878.975.0.594-.378 1.484-.575 2.306-.166.691.344 1.253 1.025 1.253 1.231.0 2.178-1.3 2.178-3.175.0-1.659-1.194-2.819-2.894-2.819-1.972.0-3.128 1.478-3.128 3.009.0.597.228 1.234.516 1.581.056.069.066.128.047.2a95.89 95.89.0 01-.194.787c-.031.128-.1.153-.231.094-.866-.403-1.406-1.669-1.406-2.684.0-2.188 1.587-4.194 4.578-4.194 2.403.0 4.272 1.712 4.272 4.003.0 2.388-1.506 4.313-3.597 4.313-.703.0-1.362-.366-1.588-.797.0.0-.347 1.322-.431 1.647-.156.603-.578 1.356-.862 1.816a6.93 6.93.0 008.984-6.622A6.931 6.931.0 008.001 1.068z"/></g></symbol><symbol id="icon-search" viewBox="0 0 16 16"><g><path d="M15.504 13.616l-3.79-3.223c-.392-.353-.811-.514-1.149-.499a6 6 0 10-.672.672c-.016.338.146.757.499 1.149l3.223 3.79c.552.613 1.453.665 2.003.115s.498-1.452-.115-2.003zM6 10a4 4 0 110-8 4 4 0 010 8z"/></g></symbol><symbol id="icon-strava" viewBox="0 0 24 24"><g><path d="M15.387 17.944l-2.089-4.116h-3.065L15.387 24l5.15-10.172h-3.066m-7.008-5.599 2.836 5.598h4.172L10.463.0l-7 13.828h4.169"/></g></symbol><symbol id="icon-threads" viewBox="0 0 100 100"><g><path d="M48.793 51.383c-2.204.298-3.997 1.235-5.035 2.644-.85 1.148-1.145 2.546-.88 4.139.25 1.484.71 4.252 7.99 4.252 6.972.0 8.895-7.01 9.426-10.856-1.853-.369-3.868-.558-6.019-.558-1.75.0-3.58.124-5.482.379z"/><path d="M97.432 20.541C95.764 11.247 88.7 4.188 79.437 2.557c-19.5-3.429-39.563-3.39-58.888.003-9.257 1.663-16.316 8.722-17.981 17.994A171.192 171.192.0 000 50.077c0 9.779.864 19.66 2.568 29.358 1.63 9.264 8.688 16.328 17.998 18.002A171.463 171.463.0 0050.083 1e2c9.772.0 19.647-.861 29.354-2.563 9.442-1.663 16.338-8.56 18-18.002A170.58 170.58.0 001e2 50.077c0-9.881-.861-19.812-2.568-29.536zM79.854 40.407c-1.771.59-3.678-.439-4.23-2.224-3.987-12.831-11.436-18.065-25.704-18.065-17.323.0-25.392 10.02-25.392 31.53.0 18.16 8.911 27.922 25.771 28.226 7.15.249 13.57-2.043 17.633-6.02 2.773-2.713 4.241-6.045 4.241-9.626.0-3.776-1.284-6.815-3.819-9.036a12.92 12.92.0 00-1.609-1.198c-1.771 9.443-7.692 15.186-15.877 15.186-10.75.0-13.905-5.385-14.658-9.898-.572-3.424.16-6.631 2.107-9.27 2.134-2.893 5.536-4.789 9.583-5.33 4.382-.586 8.477-.575 12.155-.038-.606-2.612-1.814-4.746-3.51-6.017-3.797-2.792-10.698-2.527-14.485 2.354a3.372 3.372.0 01-4.743.602 3.381 3.381.0 01-.603-4.743c6.256-8.073 17.377-8.4 23.861-3.644 3.825 2.872 6.154 7.699 6.598 13.414 2.129.91 4.02 2.075 5.64 3.494 4.002 3.511 6.12 8.392 6.12 14.124.0 5.363-2.226 10.5-6.272 14.46-5.19 5.076-13.045 7.958-21.658 7.958-.281.0-.557-.006-.834-.011-20.587-.368-32.401-13.121-32.401-34.987.0-25.408 10.817-38.29 32.152-38.29 17.334.0 27.253 7.037 32.16 22.82a3.38 3.38.0 01-2.226 4.229z"/></g></symbol><symbol id="icon-tumblr" viewBox="0 0 16 16"><g><path d="M9.001 7v3.659c0 .928-.012 1.463.086 1.727.098.262.342.534.609.691.354.212.758.318 1.214.318.81.0 1.289-.107 2.09-.633v2.405a9.089 9.089.0 01-1.833.639A7.93 7.93.0 019.369 16a4.9 4.9.0 01-1.725-.276 4.195 4.195.0 01-1.438-.79c-.398-.343-.672-.706-.826-1.091s-.23-.944-.23-1.676V6.556H3.003V4.29c.628-.204 1.331-.497 1.778-.877a4.386 4.386.0 001.08-1.374C6.133 1.505 6.32.825 6.422.0h2.579v4H13v3H9.001z"/></g></symbol><symbol id="icon-twitter" viewBox="0 0 16 16"><g><path d="M16 3.538a6.461 6.461.0 01-1.884.516 3.301 3.301.0 001.444-1.816 6.607 6.607.0 01-2.084.797 3.28 3.28.0 00-2.397-1.034A3.28 3.28.0 007.882 6.029 9.321 9.321.0 011.116 2.598a3.284 3.284.0 001.015 4.381A3.301 3.301.0 01.643 6.57v.041A3.283 3.283.0 003.277 9.83a3.291 3.291.0 01-1.485.057 3.293 3.293.0 003.066 2.281 6.586 6.586.0 01-4.862 1.359 9.286 9.286.0 005.034 1.475c6.037.0 9.341-5.003 9.341-9.341.0-.144-.003-.284-.009-.425a6.59 6.59.0 001.637-1.697z"/></g></symbol><symbol id="icon-vimeo" viewBox="0 0 16 16"><g><path d="M15.994 4.281c-.072 1.556-1.159 3.691-3.263 6.397-2.175 2.825-4.016 4.241-5.522 4.241-.931.0-1.722-.859-2.366-2.581-.431-1.578-.859-3.156-1.291-4.734-.478-1.722-.991-2.581-1.541-2.581-.119.0-.538.253-1.256.753l-.753-.969c.791-.694 1.569-1.388 2.334-2.081 1.053-.909 1.844-1.387 2.372-1.438 1.244-.119 2.013.731 2.3 2.553.309 1.966.525 3.188.647 3.666.359 1.631.753 2.447 1.184 2.447.334.0.838-.528 1.509-1.588.669-1.056 1.028-1.862 1.078-2.416.097-.912-.262-1.372-1.078-1.372a2.98 2.98.0 00-1.184.263c.787-2.575 2.287-3.825 4.506-3.753 1.641.044 2.416 1.109 2.322 3.194z"/></g></symbol><symbol id="icon-wordpress" viewBox="0 0 16 16"><g><path d="M2 8c0 2.313 1.38 4.312 3.382 5.259L2.52 5.622A5.693 5.693.0 002 8zm10.05-.295c0-.722-.266-1.222-.495-1.612-.304-.482-.589-.889-.589-1.371.0-.537.418-1.037 1.008-1.037.027.0.052.003.078.005A6.064 6.064.0 008 2.156 6.036 6.036.0 002.987 4.79c.141.004.274.007.386.007.627.0 1.599-.074 1.599-.074.323-.018.361.444.038.482.0.0-.325.037-.687.055l2.185 6.33 1.313-3.835-.935-2.495a12.304 12.304.0 01-.629-.055c-.323-.019-.285-.5.038-.482.0.0.991.074 1.58.074.627.0 1.599-.074 1.599-.074.323-.018.362.444.038.482.0.0-.326.037-.687.055l2.168 6.282.599-1.947c.259-.809.457-1.389.457-1.889zm-3.945.806-1.8 5.095a6.148 6.148.0 003.687-.093.52.52.0 01-.043-.081L8.105 8.511zm5.16-3.315c.026.186.04.386.04.601.0.593-.114 1.259-.456 2.093l-1.833 5.16c1.784-1.013 2.983-2.895 2.983-5.051a5.697 5.697.0 00-.735-2.803zM8 0a8 8 0 100 16A8 8 0 008 0zm0 15A7 7 0 118 1a7 7 0 010 14z"/></g></symbol><symbol id="icon-youtube" viewBox="0 0 16 16"><g><path d="M15.841 4.8s-.156-1.103-.637-1.587c-.609-.637-1.291-.641-1.603-.678-2.237-.163-5.597-.163-5.597-.163h-.006s-3.359.0-5.597.163c-.313.038-.994.041-1.603.678C.317 3.697.164 4.8.164 4.8S.005 6.094.005 7.391v1.213c0 1.294.159 2.591.159 2.591s.156 1.103.634 1.588c.609.637 1.409.616 1.766.684 1.281.122 5.441.159 5.441.159s3.363-.006 5.6-.166c.313-.037.994-.041 1.603-.678.481-.484.637-1.588.637-1.588s.159-1.294.159-2.591V7.39c-.003-1.294-.162-2.591-.162-2.591zm-9.494 5.275V5.578l4.322 2.256-4.322 2.241z"/></g></symbol></svg><header class=l-header><p class="c-title p-title"><a href=https://heathhenley.dev/ class=p-title__link>Blogging by Heathâ„¢</a></p><p class=p-subtitle>A mostly technical blog and collection of my notes and thoughts</p></header><main id=main class=l-main><article class=p-article><header><h1>How Does S-63 Electronic Navigational Chart (ENC) Format Work?</h1><div><div class=c-meta>Posted on
<time datetime=2024-01-30T19:18:13-05:00>Jan 30, 2024</time>
|
3291 words
|
~16mins</div></div><a href=https://heathhenley.dev/tags/python class=c-tag>python</a>
<a href=https://heathhenley.dev/tags/encs class=c-tag>ENCs</a>
<a href=https://heathhenley.dev/tags/s63 class=c-tag>S63</a>
<a href=https://heathhenley.dev/tags/s57 class=c-tag>S57</a>
<a href=https://heathhenley.dev/tags/gis class=c-tag>GIS</a>
<a href=https://heathhenley.dev/tags/cryptography class=c-tag>cryptography</a></div></header><section id=js-article class=p-article__body><p>TL;DR: S-63 is a standard used to encrypt official Electronic Navigational Charts (ENCs). Encryption and
signing allow clients to be sure that they have official data and that it has
not been tampered with. It also make it possible for data providers to license
sections of the charts (cells) and be sure that they are not being shared
illegally / pirated. This post gives an overview of the process and shows how
to implement the key steps. All of the examples are implemented in python and available
in a <a href=https://gist.github.com/heathhenley/7ecf13aec81eb09399d204e240306e00>Gist</a>.</p><h2 id=vector-charts-and-s-57-format>Vector Charts and S-57 Format</h2><p>The International Hydrographic Organization (IHO) has defined a standard for
vector navigational charts called <a href=https://iho.int/uploads/user/pubs/standards/s-57/31Main.pdf>S-57</a>.
The standard defines how to store the data, what attributes to use, etc,
and the format is open so that anyone can implement it. NOAA even publishes all
their ENC data in S-57 format, you can <a href=https://charts.noaa.gov/ENCs/ENCs.shtml>download the data</a> or
<a href=https://www.nauticalcharts.noaa.gov/enconline/enconline.html>view it in a web viewer</a>.
Ships over a certain size are required to have
official ENCs on board (due to <a href=https://www.imo.org/en/About/Conventions/Pages/International-Convention-for-the-Safety-of-Life-at-Sea-(SOLAS),-1974.aspx>SOLAS</a>) - they previously used paper charts.</p><p>Still though, how does the captain know that the data it has is official and
hasn&rsquo;t been tampered with or corrupted? And do the providing agencies have any
way to control who can access the data, so they can get their money? The answer
that the IHO came up with is the S-63 standard, a process for encrypting and
signing the S-57 ENC data.</p><h2 id=iho-s-63-standard>IHO S-63 Standard</h2><p>The IHO S-63 standard defines a process for encrypting and signing S-57 data,
you can find the full standard here in <a href=https://iho.int/uploads/user/pubs/standards/s-63/S-63_2020_Ed1.2.1_EN_Draft_Clean.pdf>IHO Publication S-63</a>. If you
like to dig though standards like that, and want even more detail than what
is given in this blog, I recommend you go straight to the source. The whole
process is defined and if you&rsquo;re into that sort of thing you can
skip the rest of this post and check that out to get an idea of it instead.
I&rsquo;m going to attempt to explain the process in a more approachable way, and
include some code examples that complete the most important parts.</p><h3 id=why---what-problem-does-s-63-solve>Why - What Problem Does S-63 Solve?</h3><p>The IHO &ldquo;surveyed&rdquo; the hydrographic offices of the world (the ones that
participate in the IHO at least) and found that there was a general consensus
that they wanted to
establish a security scheme for their electronic charts. They were concerned
about piracy of their data due to the implications that may have for navigation
safety and, for their bottom line (second part is not in the official
documentation ðŸ˜‰). This is what they came up with.</p><h3 id=first---whos-involved>First - who&rsquo;s involved?</h3><p>Sticking to the naming used in the official documentation, here are the main
players in the S-63 process:</p><ul><li>Scheme Administrator - the one, the only, you guessed it, the IHO</li><li>Data Server - provides the official data, there are lot of these, most
associated with the hydrographic offices or other official distributors of
the data</li><li>Data Client - the one who wants to use the data, usually a ship or other
vessel</li><li>Original Equipment Manufacturer (OEM) - this is where I got all my experience
with this lovely process. This is the company that makes a navigation system,
like a chart plotter, or other software (voyage planning, etc) that wants to let
their users pull in official ENC data.</li></ul><p>Maybe a picture will help:</p><p><img src=/s63/players.png alt="S-63 Players"></p><p>It&rsquo;s basically a central &lsquo;authority&rsquo; (the IHO) that defines the process, and then
the data servers get the official data and OEMs set up their software to display
it for the user.</p><h3 id=whats-the-process>What&rsquo;s the process?</h3><h4 id=overview>Overview</h4><p>As a high level overview, here&rsquo;s what happens:</p><ul><li>the data server gets the official data from the hydrographic office or another
official distributor, whoever is making the actual charts from the survey data</li><li>the data is in standard S-57 format (the standard for vector charts)</li><li>the data server encrypts the data with a random key (we&rsquo;ll see more later)</li><li>the data server sends out the encrypted data to any users who might want it</li><li>a user who wants to use the data must send a User Permit Number (UPN) to the
data server, and probably some money too (to license the data for a certain
period of time, or for a certain geographic area, etc)</li><li>the data server gladly takes the user&rsquo;s money, and User Permit Number, and then
sends the user a &ldquo;permit&rdquo; file, which contains the key that was used to
encrypt the parts of the data that the user has licensed</li></ul><p>The tricky part here is that the User Permit Number (UPN) is installation specific,
so every client for a given OEM will have a different one. They need be able to send a unique
hardware identifier to the data server, and then receive the key(s) needed to
decrypt the data in a way that is secure. So the rest of this post is about how
that actually happens, and how to implement some of the main parts in Python.</p><p>Is it really secure? I don&rsquo;t know, I&rsquo;m not a security expert. I do know that
the scheme was
put in place years ago though. It only uses a 40-bit encryption key for
the data. It&rsquo;s not unreasonable to brute force 40-bits (we&rsquo;ll probably be trying
that in another blog). The scheme might not stop a determined attacker from
accessing the data if for some reason they really want some
of that juicy navigation info. However, the encrypted cells are also
signed so that their origin can be confirmed, and if the signature checks out (and the correct public key is
used checking the signature), the user can trust the origin of the data.</p><p>A new <a href=https://iho.int/uploads/user/pubs/standards/s-100/S-100_5.1.0_Final_Clean.pdf>S-100 standard</a> is set to replace S-57 and S-63,
but it will likely be a while before it replaces the old standards. In the new
standard, AES in CBC block mode is used for encryption instead of Blowfish. The big change is
that the key size can be 128, 192, or 256 bits. That&rsquo;s a big improvement over the 40-bit
keys in this standard&mldr;</p><p>Either way, let&rsquo;s look at how to implement each piece, and maybe see how they
fit together a bit better.</p><h4 id=the-manufacturer-id-and-private-key>The Manufacturer ID and Private Key</h4><p>The first step for the OEM who wants to show S-63 data in their software is to
register with the IHO. Once approved, they will be assigned a &ldquo;manufacturer id&rdquo;
(<code>M_ID</code>) and a &ldquo;manufacturers key&rdquo; (<code>M_KEY</code>). The list of OEM <code>M_ID</code> and
<code>M_KEY</code> pairs is shared with the official data servers, but not with users,
other OEMs, or anyone else. The <code>M_ID</code> is a 2 character alphanumeric code, but
represented using it&rsquo;s ASCII representation in hexadecimal. So for example, the
<code>M_ID</code> <code>01</code> is represented as <code>3031</code>. The <code>M_KEY</code> is a five character hexadecimal
number, but also often represented using it&rsquo;s ASCII representation in hexadecimal. So
the <code>M_KEY</code> <code>123AB</code> is represented as <code>3132334142</code>. This needs to be kept secret
by the OEM. The IHO shares this with the data servers by a secure means that
is no doubt well documented, so that they have access to it in later steps.</p><p>We can flip these around in python by encoding the ASCII representation to
bytes and then dumping to hex:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># ascii str of hex chars to hexstr</span>
</span></span><span style=display:flex><span><span style=color:#e6db74>&#34;01&#34;</span><span style=color:#f92672>.</span>encode()<span style=color:#f92672>.</span>hex() <span style=color:#75715e># --&gt; &#39;3031&#39;</span>
</span></span><span style=display:flex><span><span style=color:#e6db74>&#34;123AB&#34;</span><span style=color:#f92672>.</span>encode()<span style=color:#f92672>.</span>hex() <span style=color:#75715e># --&gt; &#39;3132334142&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># back the other way</span>
</span></span><span style=display:flex><span>bytes<span style=color:#f92672>.</span>fromhex(<span style=color:#e6db74>&#34;3031&#34;</span>)<span style=color:#f92672>.</span>decode() <span style=color:#75715e># --&gt; &#39;01&#39;</span>
</span></span><span style=display:flex><span>bytes<span style=color:#f92672>.</span>fromhex(<span style=color:#e6db74>&#34;3132334142&#34;</span>)<span style=color:#f92672>.</span>decode() <span style=color:#75715e># --&gt; &#39;123AB&#39;</span>
</span></span></code></pre></div><h4 id=the-hardware-id>The Hardware ID</h4><p>So to really get started - we want each installation to have a unique
identifier, so that the data server can license the data to the specific
users / specific installations. We know that each approved OEM has an <code>M_ID</code>
and <code>M_KEY</code> assigned by the IHO. Next, the OEM generating this installation
specific identifier is the first step in the real process.</p><p>As mentioned, the install specific identifier is called the Hardware ID, and
each OEM has their own process for generating it. They could come from serial
numbers of some piece of hardware, be randomly generated, etc, they just need to be unique. It&rsquo;s not meant to be
shared with the user in raw format. This is a five character string of
hexadecimal characters, and it&rsquo;s recommended that it is not generated
sequentially.</p><p>For example, a valid hardware id is &ldquo;A79AB&rdquo; - this is the one used in the S-63
docs as an example.</p><p>What&rsquo;s our goal now? We want to find a way to give the data server the hardware
id (<code>HW_ID</code>) for a specific installation. They can then use that to encrypt the
key that they used to encrypt the cell of S-57 data, and send the cell key back to the user.
Then the user can use the same hardware id to decrypt the cell key, and then use
that cell key to decrypt the S-57 data that they have licensed!</p><p>But how do we get the hardware id to the data server in a secure way? We don&rsquo;t
want to just send it and risk it being intercepted, corrupted, or tampered
with. We need to encrypt it somehow&mldr;</p><h4 id=the-user-permit-number>The User Permit Number</h4><p>The User Permit Number (UPN) is the way that the user can send the hardware id
to the data server in a secure way. The OEM software the user is using takes the
hardware id and encrypts it with the <code>M_KEY</code> (the one that the IHO assigned to
the OEM). This results in 16 hex characters. Then a CRC32 checksum is calculated
and added to it (8 hex characters). Finally the <code>M_ID</code> is added to the end, in
hex string format (4 hex characters). So we end up with a 28 character string
that looks like:</p><p><img src=/s63/upn.png alt="User Permit Illustration"></p><p>So let&rsquo;s look at an example of how to make a User Permit Number. We&rsquo;ll use the
the IHO&rsquo;s <a href=https://iho.int/uploads/user/Services%20and%20Standards/ENC_ECDIS/data_protection/S-63_Test_Data_Implementation_Guide_v1.1.pdf>implementation test kit</a>, with the numbers: <code>M_ID</code> is <code>10</code> and the
<code>M_KEY</code> is <code>10121</code>. The hardware id for this &ldquo;installation&rdquo; is <code>12345</code>.</p><p>First, we need to encrypt the hardware id (<code>12345</code>) using the <a href=https://en.wikipedia.org/wiki/Blowfish_(cipher)>Blowfish
algorithm</a> using the <code>M_KEY</code> as the key. We can use the <code>pycryptodome</code> package
(<code>pip install pycryptodome</code>) to do this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> Crypto.Cipher <span style=color:#f92672>import</span> Blowfish
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Assigned to manufacturer (OEM) by IHO:</span>
</span></span><span style=display:flex><span>m_id <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;10&#34;</span>
</span></span><span style=display:flex><span>m_key <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;10121&#34;</span><span style=color:#f92672>.</span>encode()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Generated by manufacturer (OEM) for each installation:</span>
</span></span><span style=display:flex><span><span style=color:#75715e># - padded to 8 bytes</span>
</span></span><span style=display:flex><span>hw_id <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;12345&#34;</span><span style=color:#f92672>.</span>encode() <span style=color:#f92672>+</span> <span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\x03</span><span style=color:#e6db74>&#34;</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Encrypt hardware id with blowfish and m_key</span>
</span></span><span style=display:flex><span>cipher <span style=color:#f92672>=</span> Blowfish<span style=color:#f92672>.</span>new(m_key, Blowfish<span style=color:#f92672>.</span>MODE_ECB)
</span></span><span style=display:flex><span>encrypted_hw_id <span style=color:#f92672>=</span> cipher<span style=color:#f92672>.</span>encrypt(hw_id)<span style=color:#f92672>.</span>hex()<span style=color:#f92672>.</span>upper()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Encrypted HW_ID: </span><span style=color:#e6db74>{</span>encrypted_hw_id<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#75715e># --&gt; Encrypted HW_ID: 66B5CBFDF7E4139D</span>
</span></span></code></pre></div><p>Next, we need to calculate the CRC32 checksum of the encrypted hardware id. In
python, we can use the <code>binascii</code> package to do this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> binascii
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Compute the CRC32 checksum of the encrypted hw_id:</span>
</span></span><span style=display:flex><span>crc <span style=color:#f92672>=</span> binascii<span style=color:#f92672>.</span>crc32(encrypted_hw_id<span style=color:#f92672>.</span>encode())
</span></span><span style=display:flex><span>crc <span style=color:#f92672>=</span> <span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>{</span>crc<span style=color:#e6db74>:</span><span style=color:#e6db74>x</span><span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span><span style=color:#f92672>.</span>upper()<span style=color:#f92672>.</span>zfill(<span style=color:#ae81ff>8</span>)
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;CRC32: </span><span style=color:#e6db74>{</span>crc<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#75715e># --&gt; CRC32: 5B6086C2</span>
</span></span></code></pre></div><p>Finally we can make the actual User Permit Number by combining the <a href=https://en.wikipedia.org/wiki/Cyclic_redundancy_check>CRC32</a>
checksum, and the <code>M_ID</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>upn <span style=color:#f92672>=</span> encrypted_hw_id <span style=color:#f92672>+</span> crc <span style=color:#f92672>+</span> m_id<span style=color:#f92672>.</span>encode()<span style=color:#f92672>.</span>hex()<span style=color:#f92672>.</span>upper()
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;UPN: </span><span style=color:#e6db74>{</span>upn<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#75715e># --&gt; UPN: 66B5CBFDF7E4139D5B6086C23130</span>
</span></span></code></pre></div><p>There we go, we have the final User Permit Number of:
<code>66B5CBFDF7E4139D5B6086C23130</code> that contains (1) the encrypted <code>HW_ID</code> (
encrypted with the <code>M_KEY</code>), (2) the CRC32 checksum, and (3) the <code>M_ID</code>.</p><h4 id=thats-the-upn---whats-next>That&rsquo;s the UPN - what&rsquo;s next?</h4><p>This User Permit Number is obviously unique for each installation, as it&rsquo;s
based on the <code>HW_ID</code>. This is the number that the user will send to the data
server - remember that they have a list of all the super secret <code>M_ID</code> and
<code>M_KEY</code> pairs, so they can use the <code>M_ID</code> at the end of the UPN to look up the
corresponding <code>M_KEY</code>, and use it to decrypt the encrypted <code>HW_ID</code> out of the
UPN.</p><p>They now know the secret hardware id (<code>HW_ID</code>) for a specific installation.
They can use that hardware id to encrypt the random key that they used to
encrypt one cell (usually some defined geographic region) of the S-57 data.
They send that back to the user as a &ldquo;cell permit&rdquo;.</p><h4 id=the-permit-file>The Permit File</h4><p>The data server creates a &ldquo;cell permit&rdquo; in order to communicate the key used to
encrypt the S-57 data back to the user. The cell key (well actually two keys) is
encrypted with the hardware id (<code>HW_ID</code>) that the user sent in the UPN as
described above, and then put in the permit for the user. The user&rsquo;s software
as we said above, can then decrypt the key (it&rsquo;s knows the <code>HW_ID</code> that was
used to encrypt it) and finally, use that key to decrypt the S-57 data.</p><p>So what does that permit look like?</p><p>It contains the identifier of the ENC cell that it corresponds to, so that&rsquo;s
usually a geographic region at a particular scale. The cell names look
something like: <code>NO4D0512</code>, or <code>NO5F1615</code>. Finally, the resulting permit file
(<code>permit.txt</code> by naming convention) is going to look something like this:</p><pre tabindex=0><code>:DATE 20030909 09:02
:VERSION 1
:ENC
NO4D051220040826F7B3814E59C84805D150D571B9BE53A637BD0B34F1F8F091,0,3,0,
NO5F1615200408262324DAD11E4C2BDC6CCC1D301FC162755946447034895300,0,4,0,
:ECS
</code></pre><p>where the lines following <code>:ENC</code> are the cell name, the expiration date of the
permit, the key used to encrypt the data (but encrypted with our <code>HW_ID</code>), an
extra key (the &rsquo;next&rsquo; key that will be used to encrypt the data when the
current one rotates), another CRC32 checksum, and finally some other metadata
for the cell (version, etc).</p><p>So the actual permit (the part we care about mostly) for each cell is broken
down like so for the cell <code>NO4D0512</code> in the file above:</p><p><img src=/s63/permit.png alt="Cell Permit Illustration"></p><p>So we (we&rsquo;re the data client now) already had the encrypted S-57 data (&ldquo;S-63
data&rdquo;). Now we have the permit file from the data server with cell permits like
the one above, with one row for each cell we have paid for. They had to
generate the permit file using the hardware id (<code>HW_ID</code>) we sent them in the
UPN to encrypt the keys used for this particular ENC cell. So how did they do
that?</p><p>Let&rsquo;s look at how the data server makes a permit file for a cell. We&rsquo;ll use the
same <code>M_ID</code>, <code>M_KEY</code>, and <code>HW_ID</code> as above so that we can use the S-63 test kit
data. We&rsquo;ll stick with our <code>NO4D0512</code> cell name - the key used to encrypt the
cell data is a random 5 byte number. There is a second cell key sent along too,
it can be the next key the server will use if it rotates keys, or it could be
same as the first, that&rsquo;s a detail and it&rsquo;s up to each particular data server. Either way,
let&rsquo;s say we&rsquo;ve already generated them (maybe using <code>os.urandom(5).hex()</code> or
some other method) and we have: <code>9C467D359D</code> and <code>27737811B4</code> for the first and
second keys for the cell.</p><p>The user sent us (we&rsquo;re the data server now) the UPN <code>66B5CBFDF7E4139D5B6086C23130</code>, so we&rsquo;ve got to use
that to get their <code>HW_ID</code>, then use that to encrypt the keys for the cell. Those
last 4 characters of the UPN are the <code>M_ID</code> - here that&rsquo;s <code>3130</code>, we can use
that to look up the secret <code>M_KEY</code> in the official list of OEMs from the IHO. We
get the <code>M_KEY</code> <code>10121</code> for the <code>M_ID</code> <code>3130</code>. Then we can use that to decrypt
the <code>HW_ID</code> from the UPN:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> binascii
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> Crypto.Cipher <span style=color:#f92672>import</span> Blowfish
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>upn <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;66B5CBFDF7E4139D5B6086C23130&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># We looked up the MKEY using the MID at the end of the UPN (3130)</span>
</span></span><span style=display:flex><span>MKEY <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;10121&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># the encrypted hw id is the first 16 chars</span>
</span></span><span style=display:flex><span>encrypted_hw_id <span style=color:#f92672>=</span> upn[:<span style=color:#ae81ff>16</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># the crc check is the next 8:</span>
</span></span><span style=display:flex><span>crc <span style=color:#f92672>=</span> upn[<span style=color:#ae81ff>16</span>:<span style=color:#ae81ff>24</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># we can make sure it matches to ensure there was no error / data</span>
</span></span><span style=display:flex><span><span style=color:#75715e># integrity issues:</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>assert</span> crc <span style=color:#f92672>==</span> <span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>{</span>binascii<span style=color:#f92672>.</span>crc32(encrypted_hw_id<span style=color:#f92672>.</span>encode())<span style=color:#e6db74>:</span><span style=color:#e6db74>x</span><span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span><span style=color:#f92672>.</span>upper()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># The crc checks out, so lets decrypt the hw_id using the m_key:</span>
</span></span><span style=display:flex><span>cipher <span style=color:#f92672>=</span> Blowfish<span style=color:#f92672>.</span>new(MKEY<span style=color:#f92672>.</span>encode(), Blowfish<span style=color:#f92672>.</span>MODE_ECB)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>decrypted_hw_id <span style=color:#f92672>=</span> cipher<span style=color:#f92672>.</span>decrypt(bytes<span style=color:#f92672>.</span>fromhex(encrypted_hw_id))
</span></span><span style=display:flex><span><span style=color:#75715e># only the first 5, the rest is padding</span>
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;HW_ID: </span><span style=color:#e6db74>{</span>decrypted_hw_id[:<span style=color:#ae81ff>5</span>]<span style=color:#f92672>.</span>decode()<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#75715e># --&gt; HW_ID: 12345</span>
</span></span></code></pre></div><p>So we&rsquo;ve got the client&rsquo;s <code>HW_ID</code> now, and we can use that to encrypt the keys
for this cell:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>hw_id <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;12345&#34;</span> <span style=color:#75715e># --&gt; got this from the UPN as above</span>
</span></span><span style=display:flex><span><span style=color:#75715e># append first byte of hw_id to end of hw_id (in 9.6.2 of standard)</span>
</span></span><span style=display:flex><span>hw_id <span style=color:#f92672>=</span> hw_id <span style=color:#f92672>+</span> hw_id[<span style=color:#ae81ff>0</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># padding to 8 bytes</span>
</span></span><span style=display:flex><span>padding <span style=color:#f92672>=</span> <span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\x03</span><span style=color:#e6db74>&#34;</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># the cell keys that were randomly generated, and used to encrypt the cell</span>
</span></span><span style=display:flex><span>cell_key1, cell_key2 <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;9C467D359D&#34;</span>, <span style=color:#e6db74>&#34;27737811B4&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>cipher <span style=color:#f92672>=</span> Blowfish<span style=color:#f92672>.</span>new(hw_id<span style=color:#f92672>.</span>encode(), Blowfish<span style=color:#f92672>.</span>MODE_ECB)
</span></span><span style=display:flex><span>eck1 <span style=color:#f92672>=</span> cipher<span style=color:#f92672>.</span>encrypt(bytes<span style=color:#f92672>.</span>fromhex(cell_key1) <span style=color:#f92672>+</span> padding)<span style=color:#f92672>.</span>hex()<span style=color:#f92672>.</span>upper()
</span></span><span style=display:flex><span>eck2 <span style=color:#f92672>=</span> cipher<span style=color:#f92672>.</span>encrypt(bytes<span style=color:#f92672>.</span>fromhex(cell_key2) <span style=color:#f92672>+</span> padding)<span style=color:#f92672>.</span>hex()<span style=color:#f92672>.</span>upper()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Encrypted key 1: </span><span style=color:#e6db74>{</span>eck1<span style=color:#e6db74>}</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>Encrypted key 2: </span><span style=color:#e6db74>{</span>eck2<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#75715e># --&gt; Encrypted key 1: F7B3814E59C84805</span>
</span></span><span style=display:flex><span><span style=color:#75715e># --&gt; Encrypted key 2: D150D571B9BE53A6</span>
</span></span></code></pre></div><p>Finally, we can add the cell name, the expiration date, and the encrypted keys
together, and compute the CRC32 checksum for the permit file:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># these are fixed for the cell</span>
</span></span><span style=display:flex><span>cell_name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;NO4D0512&#34;</span>
</span></span><span style=display:flex><span>expiration_date <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;20040826&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># add the cell name, expiration date, and encrypted keys together</span>
</span></span><span style=display:flex><span>permit <span style=color:#f92672>=</span> <span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>{</span>cell_name<span style=color:#e6db74>}{</span>expiration_date<span style=color:#e6db74>}{</span>eck1<span style=color:#e6db74>}{</span>eck2<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span><span style=color:#f92672>.</span>upper()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># compute the crc32 checksum of the permit</span>
</span></span><span style=display:flex><span>hex_crc <span style=color:#f92672>=</span> <span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>{</span>binascii<span style=color:#f92672>.</span>crc32(permit<span style=color:#f92672>.</span>encode())<span style=color:#e6db74>:</span><span style=color:#e6db74>x</span><span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span><span style=color:#f92672>.</span>upper()
</span></span><span style=display:flex><span>bytes_crc <span style=color:#f92672>=</span> bytes<span style=color:#f92672>.</span>fromhex(hex_crc)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># encrypt it with the hw_id (with the special &#34;first byte appended&#34; thing)</span>
</span></span><span style=display:flex><span>encrypted_crc <span style=color:#f92672>=</span> cipher<span style=color:#f92672>.</span>encrypt(bytes_crc <span style=color:#f92672>+</span> <span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\x04</span><span style=color:#e6db74>&#34;</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>4</span>)<span style=color:#f92672>.</span>hex()<span style=color:#f92672>.</span>upper()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># add the crc to the permit</span>
</span></span><span style=display:flex><span>permit <span style=color:#f92672>+=</span> encrypted_crc
</span></span><span style=display:flex><span>print(permit})
</span></span><span style=display:flex><span><span style=color:#75715e># --&gt; NO4D051220040826F7B3814E59C84805D150D571B9BE53A637BD0B34F1F8F091</span>
</span></span></code></pre></div><p>So there we go, we&rsquo;ve got the permit for the cell <code>NO4D0512</code> that will be sent
to the user. The user&rsquo;s software can then, you guessed it, decrypt the keys
in the permit using they this system&rsquo;s <code>HW_ID</code>, and finally use them to decrypt
the S-57 data for the <code>NO4D0512</code> cell and display it.</p><p>That process starts with the reverse of what we just id, then the key is used to decrypt the chart data, and finally the data uncompressed and can be displayed.</p><h4 id=decrypting-the-s-57-data>Decrypting the S-57 Data</h4><p>So we reverse the process we just implemented to get the cell keys:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>full_permit <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;NO4D051220040826F7B3814E59C84805D150D571B9BE53A642E5B05951975E9C&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># extract encrypted cell key</span>
</span></span><span style=display:flex><span>eck1 <span style=color:#f92672>=</span> full_permit[<span style=color:#ae81ff>16</span>:<span style=color:#ae81ff>32</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># go backwards to get the cell key from the permit</span>
</span></span><span style=display:flex><span>hw_id <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;12345&#34;</span>
</span></span><span style=display:flex><span>hw_id6 <span style=color:#f92672>=</span> hw_id <span style=color:#f92672>+</span> hw_id[<span style=color:#ae81ff>0</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># decrypt the cell key</span>
</span></span><span style=display:flex><span>cipher <span style=color:#f92672>=</span> Blowfish<span style=color:#f92672>.</span>new(hw_id6<span style=color:#f92672>.</span>encode(), Blowfish<span style=color:#f92672>.</span>MODE_ECB)
</span></span><span style=display:flex><span>ck1 <span style=color:#f92672>=</span> cipher<span style=color:#f92672>.</span>decrypt(bytes<span style=color:#f92672>.</span>fromhex(eck1))[:<span style=color:#ae81ff>5</span>]
</span></span></code></pre></div><p>and then we can use the cell key to decrypt the S-57 data for the cell:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> zipfile
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># encrypted s57</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>with</span> open(<span style=color:#e6db74>&#34;NO4D0512.000&#34;</span>, <span style=color:#e6db74>&#34;rb&#34;</span>) <span style=color:#66d9ef>as</span> f:
</span></span><span style=display:flex><span>  encrypted_s57 <span style=color:#f92672>=</span> f<span style=color:#f92672>.</span>read()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># decrypt the s57 data with the cell key</span>
</span></span><span style=display:flex><span>cipher <span style=color:#f92672>=</span> Blowfish<span style=color:#f92672>.</span>new(ck1, Blowfish<span style=color:#f92672>.</span>MODE_ECB)
</span></span><span style=display:flex><span>decrypted_s57_zip <span style=color:#f92672>=</span> cipher<span style=color:#f92672>.</span>decrypt(encrypted_s57)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># check the header (the zip file header starts with PK)</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>assert</span> decrypted_s57_zip[<span style=color:#ae81ff>0</span>:<span style=color:#ae81ff>2</span>] <span style=color:#f92672>==</span> <span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;PK&#34;</span>, <span style=color:#e6db74>&#34;invalid zip&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># save a copy of the decrypted chart</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>with</span> open(<span style=color:#e6db74>&#34;NO4D0512_decrypted.000&#34;</span>, <span style=color:#e6db74>&#34;wb&#34;</span>) <span style=color:#66d9ef>as</span> f:
</span></span><span style=display:flex><span>  f<span style=color:#f92672>.</span>write(decrypted_s57_zip)
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span><span style=color:#75715e># extract</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>with</span> zipfile<span style=color:#f92672>.</span>ZipFile(<span style=color:#e6db74>&#34;NO4D0512_decrypted.000&#34;</span>) <span style=color:#66d9ef>as</span> z:
</span></span><span style=display:flex><span>  z<span style=color:#f92672>.</span>extractall(<span style=color:#e6db74>&#34;NO4D0512_decrypted_unzipped.000&#34;</span>)
</span></span></code></pre></div><p>There you go! We have an unencrypted S-57 file that we can now display in any
chart viewer that supports the format. There&rsquo;s also a GDAL driver for it, so
it could be converted into other GIS formats, or rasterized, etc. Here&rsquo;s the
cell we just decrypted, displayed in QGIS:</p><p><img src=/s63/s57.png alt=NO4D0512></p><p>We can see all the vector layers, and while QGIS is not representing the data
as a chart plotter would, it&rsquo;s all there! It was just a quick way to check that
the decryption / extraction worked.</p><p>In the real scheme, you would want to check the second key if the first one
fails. The permit checksum should also be checked before using the keys, but
I didn&rsquo;t include that here (we&rsquo;ve already seen how to do it). Of course the
expiration data needs to be checked too to make sure the permit is still valid,
and a few other details that I didn&rsquo;t include here.</p><p>The only significant part of the process that we didn&rsquo;t cover here is that the
compressed, encrypted S-57 data is also sent with a signature that is validated
to confirm the origin of the data. Maybe that&rsquo;s a topic for another post!</p><h2 id=conclusion>Conclusion</h2><p>If you read this far, thanks! Hope you learned something, let me know if you
have any questions or comments.</p><p>The full code for this post is available in a <a href=https://gist.github.com/heathhenley/7ecf13aec81eb09399d204e240306e00>Gist</a>.</p></section><footer><nav class="p-pagination c-pagination"><div class=c-pagination__ctrl><div class=c-pagination__newer><a href=https://heathhenley.dev/posts/hacking-on-s63/>Newer</a></div><div class=c-pagination__older><a href=https://heathhenley.dev/posts/newton-fractals-are-cool/>Older</a></div></div></nav><section class=p-related><h3></h3><div class=p-related__list><div class="swiper swiper-container"><ul class=swiper-wrapper><li class="p-related__item swiper-slide"><a href=/posts/notes-from-cryptopals-challenges/><span>The Cryptopals Challenges</span></a></li><li class="p-related__item swiper-slide"><a href=/posts/newton-fractals-are-cool/><span>Newton Fractals Are Cool! And a Quick Intro to Newton's Method</span></a></li><li class="p-related__item swiper-slide"><a href=/posts/add-callout-captions-to-camtasia-2023/><span>Add Callout Captions to Camtasia 2023</span></a></li><li class="p-related__item swiper-slide"><a href=/posts/python-random-module-random-notes/><span>Random Notes About Python's Random Module</span></a></li><li class="p-related__item swiper-slide"><a href=/posts/modeling-sales-pipeline-with-monte-carlo/><span>Modeling Sales Pipeline using Monte Carlo Simulation</span></a></li><li class="p-related__item swiper-slide"><a href=/posts/update-gh-readme-with-action/><span>Update Github Profile Readme Dynamically using a Github Workflow</span></a></li></ul></div><div class=related-prev></div><div class=related-next></div></div></section><aside class=p-author><div class="c-avatar p-author__avatar"><img alt="Author Avatar" src=/heathcropped.png></div><div class=p-author__body><p class="c-title p-author__name">Heath Henley</p><p>Just your average software developing, sonar data processing rockclimber with a taste for computational thermodynamics and cookies.</p><p><a href=mailto:heath.j.henley@gmail.com>Contact me</a></p></div></aside></footer></article></main><nav class="l-nav p-menu"><ul class=p-menu__lists><li class=p-menu__listitem><a href=/>Blog</a></li><li class=p-menu__listitem><a href=/about>About</a></li><li class=p-menu__listitem><a href=/tags>Tags</a></li><li class=p-menu__listitem><a href=/tutoring>Tutoring</a></li><li class=p-menu__listitem><a href=/writing>Writing</a></li><li class=p-menu__listitem><a href=https://sites.google.com/view/english-at-pcl/home>ESOL Class</a></li></ul></nav><footer class=l-footer><ul class=c-links><li class=c-links__item><a href=https://twitter.com/Heath_Henley target=_blank><svg viewBox="0 0 64 64" class="c-links__icon"><title>twitter</title><use xlink:href="#icon-twitter"/></svg></a></li><li class=c-links__item><a href=https://instagram.com/keith_with_an_h target=_blank><svg viewBox="0 0 64 64" class="c-links__icon"><title>instagram</title><use xlink:href="#icon-instagram"/></svg></a></li><li class=c-links__item><a href=https://github.com/heathhenley target=_blank><svg viewBox="0 0 64 64" class="c-links__icon"><title>github</title><use xlink:href="#icon-github"/></svg></a></li><li class=c-links__item><a href=https://linkedin.com/in/hhenley target=_blank><svg viewBox="0 0 64 64" class="c-links__icon"><title>linkedin</title><use xlink:href="#icon-linkedin"/></svg></a></li></ul><p class=p-copyright>Heath Henley
&nbsp;&bull;&nbsp;
2024
&nbsp;&bull;&nbsp;
<a href=https://heathhenley.dev/>Blogging by Heathâ„¢</a></p></footer><script type=text/javascript src=https://heathhenley.dev/js/bundle.js defer></script></body></html>